<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AAS Portal • Automatic Access Solutions</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <script src="https://cdn.auth0.com/js/auth0-spa-js/2.0/auth0-spa-js.production.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: system-ui, -apple-system, sans-serif; background: #0a0a0f; color: #fff; min-height: 100vh; }
    
    .auth-overlay { position: fixed; inset: 0; background: rgba(10,10,15,0.98); display: flex; align-items: center; justify-content: center; z-index: 9999; }
    .auth-overlay.hidden { display: none; }
    .auth-card { text-align: center; padding: 40px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; max-width: 400px; }
    .auth-title { font-size: 28px; font-weight: 700; margin: 0 0 8px; background: linear-gradient(135deg, #00d4ff, #6ea8fe); -webkit-background-clip: text; -webkit-text-fill-color: transparent; display: none; }
    .auth-subtitle { color: rgba(255,255,255,0.7); margin: 0 0 24px; display: none; }
    .auth-btn { display: none; background: linear-gradient(135deg, #00d4ff, #0099cc); color: #0a0a0f; border: none; padding: 14px 32px; border-radius: 12px; font-weight: 700; font-size: 16px; cursor: pointer; }
    .auth-spinner { width: 40px; height: 40px; border: 3px solid rgba(255,255,255,0.1); border-top-color: #00d4ff; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 16px; }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    .page-content { display: none; }
    
    .dashboard { max-width: 1200px; margin: 0 auto; padding: 24px; padding-top: 80px; }
    .dashboard-header { display: flex; justify-content: center; align-items: center; flex-wrap: wrap; gap: 1rem; margin-bottom: 32px; padding-bottom: 24px; border-bottom: 1px solid rgba(255,255,255,0.1); }
    .dashboard-logo { display: flex; align-items: center; gap: 16px; }
    .dashboard-logo img { height: 60px; filter: drop-shadow(0 0 20px rgba(0,212,255,0.5)); }
    .dashboard-logo h1 { font-size: 24px; font-weight: 700; letter-spacing: 2px; color: #b8e5ff; text-shadow: 0 0 10px rgba(0,212,255,0.7); }
    .nav-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
    .nav-card { display: flex; flex-direction: column; gap: 12px; padding: 24px; background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; text-decoration: none; color: inherit; transition: transform 0.2s, border-color 0.2s, box-shadow 0.2s; }
    .nav-card:hover { transform: translateY(-4px); border-color: rgba(0,212,255,0.4); box-shadow: 0 12px 40px rgba(0,212,255,0.15); }
    .nav-card__icon { width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; background: rgba(0,212,255,0.15); border-radius: 12px; }
    .nav-card__icon svg { width: 24px; height: 24px; stroke: #00d4ff; }
    .nav-card__title { font-size: 18px; font-weight: 700; }
    .nav-card__desc { font-size: 14px; color: rgba(255,255,255,0.6); line-height: 1.5; }
    .version { text-align: center; margin-top: 48px; font-size: 12px; color: rgba(255,255,255,0.4); }
    
    .floating-user { position: fixed; top: 16px; right: 16px; display: flex; align-items: center; gap: 12px; padding: 8px 12px 8px 16px; background: rgba(20, 20, 30, 0.9); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); border-radius: 50px; z-index: 9000; }
    .floating-user__info { text-align: right; }
    .floating-user__name { font-size: 13px; color: rgba(255,255,255,0.9); max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .floating-user__role { font-size: 10px; color: #00d4ff; text-transform: uppercase; letter-spacing: 0.5px; }
    .floating-user__logout { display: flex; align-items: center; justify-content: center; width: 32px; height: 32px; background: rgba(255,255,255,0.1); border: none; border-radius: 50%; color: #fff; cursor: pointer; transition: all 0.2s; }
    .floating-user__logout:hover { background: rgba(239, 68, 68, 0.3); color: #ef4444; }
    .floating-user__logout svg { width: 16px; height: 16px; }
    
    .nav-toggle { position: fixed; top: 16px; left: 16px; width: 44px; height: 44px; display: flex; align-items: center; justify-content: center; background: rgba(20, 20, 30, 0.9); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; z-index: 9001; cursor: pointer; }
    .nav-toggle:hover { background: rgba(0, 212, 255, 0.15); border-color: rgba(0, 212, 255, 0.3); }
    .nav-toggle svg { width: 22px; height: 22px; stroke: #fff; }
    .nav-toggle.active svg.menu-icon { display: none; }
    .nav-toggle svg.close-icon { display: none; }
    .nav-toggle.active svg.close-icon { display: block; }
    
    .nav-panel { position: fixed; top: 0; left: 0; width: 280px; max-width: 85vw; height: 100vh; background: rgba(15, 15, 25, 0.98); backdrop-filter: blur(30px); border-right: 1px solid rgba(255,255,255,0.1); z-index: 8999; transform: translateX(-100%); transition: transform 0.3s ease; display: flex; flex-direction: column; padding: 80px 20px 20px; }
    .nav-panel.open { transform: translateX(0); }
    .nav-panel__overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 8998; opacity: 0; pointer-events: none; transition: opacity 0.3s; }
    .nav-panel__overlay.open { opacity: 1; pointer-events: auto; }
    .nav-panel__link { display: flex; align-items: center; gap: 12px; padding: 14px 16px; color: rgba(255,255,255,0.8); text-decoration: none; border-radius: 10px; transition: all 0.2s; font-size: 15px; font-weight: 500; }
    .nav-panel__link:hover { background: rgba(0, 212, 255, 0.1); color: #fff; }
    .nav-panel__link.active { background: rgba(0, 212, 255, 0.15); color: #00d4ff; }
    .nav-panel__link svg { width: 20px; height: 20px; opacity: 0.7; }
    .nav-panel__section { font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: rgba(255,255,255,0.4); padding: 20px 16px 8px; margin-top: 8px; }
    .nav-panel__divider { height: 1px; background: rgba(255,255,255,0.1); margin: 12px 0; }
    
    @media (max-width: 480px) {
      .floating-user__name, .floating-user__role { display: none; }
      .floating-user { padding: 6px 6px 6px 10px; gap: 8px; }
    }
  </style>
</head>
<body>
  <div id="authOverlay" class="auth-overlay">
    <div class="auth-card">
      <div class="auth-spinner"></div>
      <p id="authLoadingText">Loading...</p>
      <h1 class="auth-title">AAS Portal</h1>
      <p class="auth-subtitle">Please sign in to continue</p>
      <button id="authLoginBtn" class="auth-btn">Sign In</button>
    </div>
  </div>
  
  <button class="nav-toggle" id="navToggle" onclick="toggleNav()">
    <svg class="menu-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" /></svg>
    <svg class="close-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
  </button>
  
  <div class="nav-panel__overlay" id="navOverlay" onclick="toggleNav()"></div>
  
  <nav class="nav-panel" id="navPanel">
    <a href="/" class="nav-panel__link active" id="navDashboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>Dashboard</a>
    <div class="nav-panel__section">Tools</div>
    <a href="/tech/command/" class="nav-panel__link" id="navCommand"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>Command Center</a>
    <a href="/tech/parts/" class="nav-panel__link"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>Parts Finder</a>
    <a href="/tech/manuals/" class="nav-panel__link"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" /></svg>Tech Manuals</a>
    <a href="/tech/doors/" class="nav-panel__link"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 21h18M5 21V5a2 2 0 012-2h10a2 2 0 012 2v16" /></svg>Door Browser</a>
    <a href="/tech/summary/" class="nav-panel__link" id="navSummary"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" /></svg>Work Summary</a>
    <div class="nav-panel__divider"></div>
    <a href="https://app.limblecmms.com" target="_blank" rel="noopener" class="nav-panel__link"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>Open Limble</a>
  </nav>
  
  <div class="floating-user" id="floatingUser" style="display:none;">
    <div class="floating-user__info">
      <div class="floating-user__name" id="floatingUserName">User</div>
      <div class="floating-user__role" id="floatingUserRole">-</div>
    </div>
    <button class="floating-user__logout" onclick="window.AASAuth?.logout()" title="Sign Out">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>
    </button>
  </div>
  
  <div id="pageContent" class="page-content">
    <div class="dashboard">
      <header class="dashboard-header">
        <div class="dashboard-logo">
          <img src="https://images.squarespace-cdn.com/content/53292562e4b06710691770b4/c75debc4-7194-4008-875d-856c6fa3b205/dis+lis+logo.webp?content-type=image%2Fwebp" alt="AAS Logo">
          <h1>AAS PORTAL</h1>
        </div>
      </header>
      
      <nav class="nav-grid">
        <a href="/tech/command/" class="nav-card" id="cardCommand">
          <div class="nav-card__icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg></div>
          <h2 class="nav-card__title">Command Center</h2>
          <p class="nav-card__desc">Search manuals, parts, service records, and doors — all in one place.</p>
        </a>
        <a href="/tech/manuals/" class="nav-card">
          <div class="nav-card__icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 016.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 014 19.5v-15A2.5 2.5 0 016.5 2z"/></svg></div>
          <h2 class="nav-card__title">Tech Manuals</h2>
          <p class="nav-card__desc">Access manufacturer manuals for Horton, Stanley, Besam, and NABCO doors.</p>
        </a>
        <a href="/tech/parts/" class="nav-card">
          <div class="nav-card__icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 000 1.4l1.6 1.6a1 1 0 001.4 0l3.77-3.77a6 6 0 01-7.94 7.94l-6.91 6.91a2.12 2.12 0 01-3-3l6.91-6.91a6 6 0 017.94-7.94l-3.76 3.76z"/></svg></div>
          <h2 class="nav-card__title">Parts Finder</h2>
          <p class="nav-card__desc">Search by part number, manufacturer, or description.</p>
        </a>
        <a href="/tech/doors/" class="nav-card">
          <div class="nav-card__icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 21h18"/><path d="M5 21V5a2 2 0 012-2h10a2 2 0 012 2v16"/><circle cx="15" cy="12" r="1" fill="currentColor"/></svg></div>
          <h2 class="nav-card__title">Door Browser</h2>
          <p class="nav-card__desc">Search and filter all doors across customer locations.</p>
        </a>
        <a href="/tech/summary/" class="nav-card" id="cardSummary">
          <div class="nav-card__icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2"/><rect x="9" y="3" width="6" height="4" rx="1"/></svg></div>
          <h2 class="nav-card__title">Work Summary</h2>
          <p class="nav-card__desc">View completed work orders and service records.</p>
        </a>
        <a href="https://app.limblecmms.com" target="_blank" rel="noopener" class="nav-card">
          <div class="nav-card__icon" style="background: rgba(34,197,94,0.15);"><svg viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg></div>
          <h2 class="nav-card__title">Open Limble</h2>
          <p class="nav-card__desc">Go to Limble CMMS dashboard for work orders and tasks.</p>
        </a>
      </nav>
      
      <p class="version">AAS Portal v4.0.1</p>
    </div>
  </div>

  <script>
    function toggleNav() {
      document.getElementById('navToggle').classList.toggle('active');
      document.getElementById('navPanel').classList.toggle('open');
      document.getElementById('navOverlay').classList.toggle('open');
    }
    
    // Hide admin-only items for non-admins
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(async () => {
        if (window.AASAuth) {
          const roles = await window.AASAuth.getUserRoles();
          const isAdmin = roles.includes('Admin');
          ['navDashboard', 'navCommand', 'navSummary', 'cardCommand', 'cardSummary'].forEach(id => {
            const el = document.getElementById(id);
            if (el) el.style.display = isAdmin ? 'flex' : 'none';
          });
        }
      }, 500);
    });
  </script>
  <script src="/auth.js"></script>
</body>
</html>
