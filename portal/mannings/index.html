<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Manning Portal â€¢ AAS</title>
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<script src="https://cdn.auth0.com/js/auth0-spa-js/2.0/auth0-spa-js.production.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

<style>
body{font-family:system-ui;background:#050508;color:#f5f5fa;margin:0}
.portal{padding:20px;max-width:1200px;margin:auto}
.section{margin-bottom:20px;background:#111;border-radius:12px;padding:16px}
h1{margin-bottom:4px}
.table-wrap{overflow-x:auto}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid #222}
.badge{padding:3px 8px;border-radius:6px;font-size:12px}
.badge.pass{background:#22c55e22;color:#22c55e}
.badge.fail{background:#ef444422;color:#ef4444}
.badge.open{background:#f59e0b22;color:#f59e0b}
.ot-task-detail{margin-top:6px;font-size:13px;color:#aaa}
.ot-label{font-size:10px;text-transform:uppercase;color:#666;margin-right:4px}
</style>
</head>

<body>
<div class="portal">

<h1>Manning</h1>
<p>Manning Family Children's Hospital</p>

<div class="section">
<h2>Life Safety Floor Map</h2>
<div>
<a href="https://drive.google.com/file/d/1aEESmL0_A1VSVkWty1AJmWhSI9sOCjhE/view" target="_blank">Open Full Screen</a> |
<a href="https://drive.google.com/uc?export=download&id=1aEESmL0_A1VSVkWty1AJmWhSI9sOCjhE">Download PDF</a>
</div>
<div style="margin-top:10px">
<iframe src="https://drive.google.com/file/d/1aEESmL0_A1VSVkWty1AJmWhSI9sOCjhE/preview"
width="100%" height="500" style="border:none;"></iframe>
</div>
</div>

<div class="section">
<h2>Door Inspections</h2>
<div class="table-wrap">
<table>
<thead>
<tr>
<th>Door ID</th>
<th>Status</th>
<th>Last Inspection</th>
<th>AAADM</th>
<th>Location</th>
<th>Notes</th>
</tr>
</thead>
<tbody id="doorsBody"></tbody>
</table>
</div>
</div>

<div class="section">
<h2>Open Tasks</h2>
<div class="table-wrap">
<table>
<thead>
<tr>
<th>Task ID</th>
<th>Door</th>
<th>Task</th>
<th>Status</th>
<th>Created</th>
</tr>
</thead>
<tbody id="openTasksBody"></tbody>
</table>
</div>
</div>

<div class="section">
<h2>Service Activity</h2>
<div class="table-wrap">
<table>
<thead>
<tr>
<th>Task ID</th>
<th>Date</th>
<th>Task</th>
<th>Technician</th>
<th>Status</th>
<th>Summary</th>
</tr>
</thead>
<tbody id="tasksBody"></tbody>
</table>
</div>
</div>

</div>

<script>

const DOOR_PREFIX = 'MH-';

const INSPECTIONS_CSV =
'https://docs.google.com/spreadsheets/d/e/2PACX-1vRaL-Cagmos7f4rCojgOROSm_Zs8Gnl41nvUUN8hXJIrDyGdv4eYhtJKq56lMRK9euN0TvFNOj_rszM/pub?gid=2106704799&single=true&output=csv';

const TASKS_CSV =
'https://docs.google.com/spreadsheets/d/e/2PACX-1vRaL-Cagmos7f4rCojgOROSm_Zs8Gnl41nvUUN8hXJIrDyGdv4eYhtJKq56lMRK9euN0TvFNOj_rszM/pub?gid=1054197999&single=true&output=csv';

const OPEN_TASKS_CSV =
'https://docs.google.com/spreadsheets/d/e/2PACX-1vRaL-Cagmos7f4rCojgOROSm_Zs8Gnl41nvUUN8hXJIrDyGdv4eYhtJKq56lMRK9euN0TvFNOj_rszM/pub?gid=1087890358&single=true&output=csv';

function parseCSV(text){
const rows=text.trim().split('\n').map(r=>r.split(','));
return rows;
}

async function loadCSV(url){
const r=await fetch(url,{cache:'no-store'});
const t=await r.text();
return parseCSV(t);
}

async function loadData(){

// DOORS
const doorData=await loadCSV(INSPECTIONS_CSV);
const doorHeaders=doorData[0];
const doorsBody=document.getElementById('doorsBody');

doorData.slice(1).forEach(row=>{
const doorId=row[doorHeaders.indexOf('Door ID')];
if(!doorId.startsWith(DOOR_PREFIX)) return;

const status=row[doorHeaders.indexOf('Status')];
const tr=document.createElement('tr');
tr.innerHTML=`
<td>${doorId}</td>
<td><span class="badge ${status==='PASS'?'pass':'fail'}">${status}</span></td>
<td>${row[doorHeaders.indexOf('Last Inspection')]||''}</td>
<td>${row[doorHeaders.indexOf('AAADM')]||''}</td>
<td>${row[doorHeaders.indexOf('Location')]||''}</td>
<td>${row[doorHeaders.indexOf('Notes')]||''}</td>
`;
doorsBody.appendChild(tr);
});

// TASKS
const taskData=await loadCSV(TASKS_CSV);
const taskHeaders=taskData[0];
const tasksBody=document.getElementById('tasksBody');

taskData.slice(1).forEach(row=>{
const tr=document.createElement('tr');
tr.innerHTML=`
<td>${row[taskHeaders.indexOf('Task ID')]||''}</td>
<td>${row[taskHeaders.indexOf('Service Date')]||''}</td>
<td>${row[taskHeaders.indexOf('Task Name')]||''}</td>
<td>${row[taskHeaders.indexOf('Technician')]||''}</td>
<td>${row[taskHeaders.indexOf('Status & type')]||''}</td>
<td>${row[taskHeaders.indexOf('Summary')]||''}</td>
`;
tasksBody.appendChild(tr);
});

// OPEN TASKS
const openData=await loadCSV(OPEN_TASKS_CSV);
const openHeaders=openData[0];
const openBody=document.getElementById('openTasksBody');

openData.slice(1).forEach(row=>{
const customer=row[openHeaders.indexOf('Customer')];
if(customer!=='Manning') return;

const taskName=row[openHeaders.indexOf('Task_Name')];
const notes=row[openHeaders.indexOf('Notes')]||'';
const plan=row[openHeaders.indexOf('Instruction Plan')]||'';

const tr=document.createElement('tr');
tr.innerHTML=`
<td>${row[openHeaders.indexOf('Task_ID')]}</td>
<td>${row[openHeaders.indexOf('Door_Name')]||''}</td>
<td>
${taskName}
<div class="ot-task-detail">
${notes?`<div><span class="ot-label">Notes:</span>${notes}</div>`:''}
${plan?`<div><span class="ot-label">Plan:</span>${plan}</div>`:''}
</div>
</td>
<td>${row[openHeaders.indexOf('Status')]||''}</td>
<td>${row[openHeaders.indexOf('Created_Date')]||''}</td>
`;
openBody.appendChild(tr);
});

}

loadData();

</script>
</body>
</html>
